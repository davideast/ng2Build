{"version":3,"file":"/Users/deast/Angular/angular/modules/core/src/compiler/pipeline/proto_element_injector_builder.js","sources":["@traceur/generated/TemplateParser/13","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/20","proto_element_injector_builder.js","@traceur/generated/TemplateParser/23","@traceur/generated/TemplateParser/2"],"names":[],"mappings":"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","sourceRoot":"/Users/deast/Angular/angular/modules/core/src/compiler/pipeline/","sourcesContent":["System.register($__placeholder__0, $__placeholder__1, function($__export) {\n          $__placeholder__2\n        });","var __moduleName = $__placeholder__0;","return {\n      setters: $__placeholder__0,\n      execute: $__placeholder__1\n    }","function(m) {\n          $__placeholder__0\n        }","$__placeholder__0 = m.$__placeholder__1;","var $__placeholder__0 = $__export($__placeholder__1, $__placeholder__2);","function($__super) {\n          var $__placeholder__0 = $__placeholder__1;\n          return ($traceurRuntime.createClass)($__placeholder__2, $__placeholder__3,\n                                               $__placeholder__4, $__super);\n        }($__placeholder__5)","import {isPresent, isBlank} from 'facade/lang';\nimport {ListWrapper} from 'facade/collection';\n\nimport {Key} from 'di/di';\nimport {ProtoElementInjector, ComponentKeyMetaData} from '../element_injector';\n\nimport {CompileStep} from './compile_step';\nimport {CompileElement} from './compile_element';\nimport {CompileControl} from './compile_control';\n\n/**\n * Creates the ProtoElementInjectors.\n *\n * Fills:\n * - CompileElement#inheriteProtoElementInjector\n *\n * Reads:\n * - (in parent) CompileElement#inheriteProtoElementInjector\n * - CompileElement#isViewRoot\n * - CompileElement#inheritedProtoView\n * - CompileElement#decoratorDirectives\n * - CompileElement#componentDirective\n * - CompileElement#templateDirective\n */\nexport class ProtoElementInjectorBuilder extends CompileStep {\n  // public so that we can overwrite it in tests\n  internalCreateProtoElementInjector(parent, index, directives, firstBindingIsComponent, distance) {\n    return new ProtoElementInjector(parent, index, directives, firstBindingIsComponent, distance);\n  }\n\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    var distanceToParentInjector = this._getDistanceToParentInjector(parent, current);\n    var parentProtoElementInjector = this._getParentProtoElementInjector(parent, current);\n    var injectorBindings = this._collectDirectiveBindings(current);\n\n    // TODO: add lightDomServices as well,\n    // but after the directives as we rely on that order\n    // in the element_binder_builder.\n\n    if (injectorBindings.length > 0) {\n      var protoView = current.inheritedProtoView;\n      var hasComponent = isPresent(current.componentDirective);\n\n      current.inheritedProtoElementInjector = this.internalCreateProtoElementInjector(\n        parentProtoElementInjector, protoView.elementBinders.length, injectorBindings,\n        hasComponent, distanceToParentInjector\n      );\n      current.distanceToParentInjector = 0;\n\n    } else {\n      current.inheritedProtoElementInjector = parentProtoElementInjector;\n      current.distanceToParentInjector = distanceToParentInjector;\n    }\n  }\n\n  _getDistanceToParentInjector(parent, current) {\n    return isPresent(parent) ? parent.distanceToParentInjector + 1 : 0;\n  }\n\n  _getParentProtoElementInjector(parent, current) {\n    if (isPresent(parent) && !current.isViewRoot) {\n      return parent.inheritedProtoElementInjector;\n    }\n    return null;\n  }\n\n  _collectDirectiveBindings(pipelineElement) {\n    var directiveTypes = [];\n    if (isPresent(pipelineElement.componentDirective)) {\n      ListWrapper.push(directiveTypes, pipelineElement.componentDirective.type);\n    }\n    if (isPresent(pipelineElement.templateDirective)) {\n      ListWrapper.push(directiveTypes, pipelineElement.templateDirective.type);\n    }\n    if (isPresent(pipelineElement.decoratorDirectives)) {\n      for (var i=0; i<pipelineElement.decoratorDirectives.length; i++) {\n        ListWrapper.push(directiveTypes, pipelineElement.decoratorDirectives[i].type);\n      }\n    }\n    return directiveTypes;\n  }\n}\n","$traceurRuntime.superConstructor(\n          $__placeholder__0).apply(this, arguments)","Object.defineProperty($__placeholder__0, $__placeholder__1,\n        {get: function() {return $__placeholder__2}});"]}